package com.spark.learning;

import org.apache.spark.SparkConf;
import org.apache.spark.api.java.JavaRDD;
import org.apache.spark.api.java.JavaSparkContext;

public class BasicLogAnalyser {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
			SparkConf conf = new SparkConf().setAppName("Basic log analyser").setMaster("local");
			JavaSparkContext contx=new JavaSparkContext(conf);
			
			String logFile="C:/Users/Vostro/Desktop/input/input.txt";
			
			JavaRDD<String> logRdd=contx.textFile(logFile).cache();
			//converting raw RDD to RDD of ApacheAcessLog objects
			JavaRDD<ApacheAccessLog> acesslog =logRdd.map(FUNCTIONS.PARSE_LOG_LINE);
			
			JavaRDD<Long> contentSize=acesslog.map(FUNCTIONS.GET_CONTENT_SIZE);
			
			System.out.println("Average Content Size: "+contentSize.reduce(FUNCTIONS.SUM_REDUCER)/contentSize.count());
			System.out.println("Minimun Content Size: "+contentSize.min(FUNCTIONS.LONG_NATURAL_ORDER_COMPARATOR));
	}

}
