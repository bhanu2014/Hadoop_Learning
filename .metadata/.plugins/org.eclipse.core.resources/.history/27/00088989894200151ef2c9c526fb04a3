package com.client.sum;

import org.apache.commons.configuration.Configuration;
import org.apache.hadoop.hbase.HBaseConfiguration;
import org.apache.hadoop.hbase.client.HConnection;
import org.apache.hadoop.hbase.client.HConnectionManager;
import org.apache.hadoop.hbase.client.HTableInterface;

public class Aggregrator {
	Configuration conf = HBaseConfiguration.create();
	HConnection connection = HConnectionManager.createConnection(conf);
	HTableInterface table = connection.getTable("users");
	final SumRequest request = SumRequest.newBuilder().setFamily("salaryDet").setColumn("gross").build();
	try {
	Map<byte[], Long> results = table.CoprocessorService (SumService.class, null, null,
	new Batch.Call<SumService, Long>() {
	    @Override
	        public Long call(SumService aggregate) throws IOException {
	BlockingRpcCallback rpcCallback = new BlockingRpcCallback();
	            aggregate.getSum(null, request, rpcCallback);
	            SumResponse response = rpcCallback.get();
	            return response.hasSum() ? response.getSum() : 0L;
	        }
	    });
	    for (Long sum : results.values()) {
	        System.out.println("Sum = " + sum);
	    }
	} catch (ServiceException e) {
	e.printStackTrace();
	} catch (Throwable e) {
	    e.printStackTrace();
	}
}
